version: '3'

services:
  build:
    image: quay.io/haskell_works/stack-build-minimal
    environment:
      GIT_AUTHOR_EMAIL: ci@restyled.io
      GIT_AUTHOR_NAME: Restyled.io CI
      GIT_COMMITTER_EMAIL: ci@restyled.io
      GIT_COMMITTER_NAME: Restyled.io CI
      STACK_ARGUMENTS: --no-terminal
    working_dir: /code
    volumes:
      - '${BUILDKITE_BUILD_CHECKOUT_PATH}:/code'
      - '/cache/restyler/.stack-work:/code/.stack-work'
      - '/cache/stack:/root/.stack'

  ops:
    image: restyled/ops
    working_dir: ${BUILDKITE_BUILD_CHECKOUT_PATH}
    volumes:
      - '/var/run/docker.sock:/var/run/docker.sock'
