<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE DeriveFunctor #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><a name="line-6"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Conduit</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span class="hs-operator">.</span><span class="hs-identifier">Fusion</span><span>
</span><a name="line-7"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-comment">-- ** Types</span><span>
</span><a name="line-8"></a><span>      </span><a href="Data.Conduit.Internal.Fusion.html#Step"><span class="hs-identifier hs-type">Step</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-9"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#Stream"><span class="hs-identifier hs-type">Stream</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-10"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-type">ConduitWithStream</span></a><span>
</span><a name="line-11"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#StreamConduitT"><span class="hs-identifier hs-type">StreamConduitT</span></a><span>
</span><a name="line-12"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#StreamConduit"><span class="hs-identifier hs-type">StreamConduit</span></a><span>
</span><a name="line-13"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#StreamSource"><span class="hs-identifier hs-type">StreamSource</span></a><span>
</span><a name="line-14"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#StreamProducer"><span class="hs-identifier hs-type">StreamProducer</span></a><span>
</span><a name="line-15"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#StreamSink"><span class="hs-identifier hs-type">StreamSink</span></a><span>
</span><a name="line-16"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#StreamConsumer"><span class="hs-identifier hs-type">StreamConsumer</span></a><span>
</span><a name="line-17"></a><span>      </span><span class="hs-comment">-- ** Functions</span><span>
</span><a name="line-18"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#streamConduit"><span class="hs-identifier hs-var">streamConduit</span></a><span>
</span><a name="line-19"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#streamSource"><span class="hs-identifier hs-var">streamSource</span></a><span>
</span><a name="line-20"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#streamSourcePure"><span class="hs-identifier hs-var">streamSourcePure</span></a><span>
</span><a name="line-21"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#unstream"><span class="hs-identifier hs-var">unstream</span></a><span>
</span><a name="line-22"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Conduit.Internal.Conduit.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Conduit</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span class="hs-operator">.</span><span class="hs-identifier">Conduit</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Conduit.Internal.Pipe.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Conduit</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span class="hs-operator">.</span><span class="hs-identifier">Pipe</span></a><span> </span><span class="hs-special">(</span><a href="Data.Conduit.Internal.Pipe.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Functor</span><span class="hs-operator">.</span><span class="hs-identifier">Identity</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Identity</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">runIdentity</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Void</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Void</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">absurd</span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-comment">-- | This is the same as stream fusion\'s Step. Constructors are renamed to</span><span>
</span><a name="line-30"></a><span class="hs-comment">-- avoid confusion with conduit names.</span><span>
</span><a name="line-31"></a><span class="hs-keyword">data</span><span> </span><a name="Step"><a href="Data.Conduit.Internal.Fusion.html#Step"><span class="hs-identifier">Step</span></a></a><span> </span><a name="local-6989586621679080123"><a href="#local-6989586621679080123"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679080124"><a href="#local-6989586621679080124"><span class="hs-identifier">o</span></a></a><span> </span><a name="local-6989586621679080125"><a href="#local-6989586621679080125"><span class="hs-identifier">r</span></a></a><span>
</span><a name="line-32"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="Emit"><a href="Data.Conduit.Internal.Fusion.html#Emit"><span class="hs-identifier">Emit</span></a></a><span> </span><a href="#local-6989586621679080123"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679080124"><span class="hs-identifier hs-type">o</span></a><span>
</span><a name="line-33"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Skip"><a href="Data.Conduit.Internal.Fusion.html#Skip"><span class="hs-identifier">Skip</span></a></a><span> </span><a href="#local-6989586621679080123"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-34"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Stop"><a href="Data.Conduit.Internal.Fusion.html#Stop"><span class="hs-identifier">Stop</span></a></a><span> </span><a href="#local-6989586621679080125"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-35"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Functor</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">data</span><span> </span><a name="Stream"><a href="Data.Conduit.Internal.Fusion.html#Stream"><span class="hs-identifier">Stream</span></a></a><span> </span><a name="local-6989586621679080119"><a href="#local-6989586621679080119"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679080120"><a href="#local-6989586621679080120"><span class="hs-identifier">o</span></a></a><span> </span><a name="local-6989586621679080121"><a href="#local-6989586621679080121"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679080122"><a href="#local-6989586621679080122"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span> </span><a name="Stream"><a href="Data.Conduit.Internal.Fusion.html#Stream"><span class="hs-identifier">Stream</span></a></a><span>
</span><a name="line-38"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621679080122"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080119"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Data.Conduit.Internal.Fusion.html#Step"><span class="hs-identifier hs-type">Step</span></a><span> </span><a href="#local-6989586621679080122"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679080120"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080121"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621679080119"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080122"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span class="hs-keyword">data</span><span> </span><a name="ConduitWithStream"><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier">ConduitWithStream</span></a></a><span> </span><a name="local-6989586621679080115"><a href="#local-6989586621679080115"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679080116"><a href="#local-6989586621679080116"><span class="hs-identifier">o</span></a></a><span> </span><a name="local-6989586621679080117"><a href="#local-6989586621679080117"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679080118"><a href="#local-6989586621679080118"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ConduitWithStream"><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier">ConduitWithStream</span></a></a><span>
</span><a name="line-42"></a><span>    </span><span class="hs-special">(</span><a href="Data.Conduit.Internal.Conduit.html#ConduitT"><span class="hs-identifier hs-type">ConduitT</span></a><span> </span><a href="#local-6989586621679080115"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679080116"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080117"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080118"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span>    </span><span class="hs-special">(</span><a href="Data.Conduit.Internal.Fusion.html#StreamConduitT"><span class="hs-identifier hs-type">StreamConduitT</span></a><span> </span><a href="#local-6989586621679080115"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679080116"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080117"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080118"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-keyword">type</span><span> </span><a name="StreamConduitT"><a href="Data.Conduit.Internal.Fusion.html#StreamConduitT"><span class="hs-identifier">StreamConduitT</span></a></a><span> </span><a name="local-6989586621679080111"><a href="#local-6989586621679080111"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679080112"><a href="#local-6989586621679080112"><span class="hs-identifier">o</span></a></a><span> </span><a name="local-6989586621679080113"><a href="#local-6989586621679080113"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679080114"><a href="#local-6989586621679080114"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#Stream"><span class="hs-identifier hs-type">Stream</span></a><span> </span><a href="#local-6989586621679080113"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080111"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#Stream"><span class="hs-identifier hs-type">Stream</span></a><span> </span><a href="#local-6989586621679080113"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080112"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080114"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-keyword">type</span><span> </span><a name="StreamConduit"><a href="Data.Conduit.Internal.Fusion.html#StreamConduit"><span class="hs-identifier">StreamConduit</span></a></a><span> </span><a name="local-6989586621679080108"><a href="#local-6989586621679080108"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679080109"><a href="#local-6989586621679080109"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679080110"><a href="#local-6989586621679080110"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#StreamConduitT"><span class="hs-identifier hs-type">StreamConduitT</span></a><span> </span><a href="#local-6989586621679080108"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679080110"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080109"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-keyword">type</span><span> </span><a name="StreamSource"><a href="Data.Conduit.Internal.Fusion.html#StreamSource"><span class="hs-identifier">StreamSource</span></a></a><span> </span><a name="local-6989586621679080106"><a href="#local-6989586621679080106"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679080107"><a href="#local-6989586621679080107"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#StreamConduitT"><span class="hs-identifier hs-type">StreamConduitT</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080107"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080106"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-keyword">type</span><span> </span><a name="StreamProducer"><a href="Data.Conduit.Internal.Fusion.html#StreamProducer"><span class="hs-identifier">StreamProducer</span></a></a><span> </span><a name="local-6989586621679080103"><a href="#local-6989586621679080103"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679080104"><a href="#local-6989586621679080104"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679080105"><a href="#local-6989586621679080105"><span class="hs-identifier">i</span></a></a><span class="hs-operator">.</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#StreamConduitT"><span class="hs-identifier hs-type">StreamConduitT</span></a><span> </span><a href="#local-6989586621679080105"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679080104"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080103"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-keyword">type</span><span> </span><a name="StreamSink"><a href="Data.Conduit.Internal.Fusion.html#StreamSink"><span class="hs-identifier">StreamSink</span></a></a><span> </span><a name="local-6989586621679080100"><a href="#local-6989586621679080100"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679080101"><a href="#local-6989586621679080101"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679080102"><a href="#local-6989586621679080102"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#StreamConduitT"><span class="hs-identifier hs-type">StreamConduitT</span></a><span> </span><a href="#local-6989586621679080100"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-identifier hs-type">Void</span><span> </span><a href="#local-6989586621679080101"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080102"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-keyword">type</span><span> </span><a name="StreamConsumer"><a href="Data.Conduit.Internal.Fusion.html#StreamConsumer"><span class="hs-identifier">StreamConsumer</span></a></a><span> </span><a name="local-6989586621679080096"><a href="#local-6989586621679080096"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679080097"><a href="#local-6989586621679080097"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679080098"><a href="#local-6989586621679080098"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679080099"><a href="#local-6989586621679080099"><span class="hs-identifier">o</span></a></a><span class="hs-operator">.</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#StreamConduitT"><span class="hs-identifier hs-type">StreamConduitT</span></a><span> </span><a href="#local-6989586621679080096"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679080099"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080097"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080098"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-identifier">unstream</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-type">ConduitWithStream</span></a><span> </span><a href="#local-6989586621679080143"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679080144"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080145"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080146"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Conduit.Internal.Conduit.html#ConduitT"><span class="hs-identifier hs-type">ConduitT</span></a><span> </span><a href="#local-6989586621679080143"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679080144"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080145"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080146"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-58"></a><a name="unstream"><a href="Data.Conduit.Internal.Fusion.html#unstream"><span class="hs-identifier">unstream</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-var">ConduitWithStream</span></a><span> </span><a name="local-6989586621679080147"><a href="#local-6989586621679080147"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080147"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-59"></a><span class="hs-pragma">{-# INLINE [0] unstream #-}</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-identifier">fuseStream</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679080138"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-62"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-type">ConduitWithStream</span></a><span> </span><a href="#local-6989586621679080139"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679080140"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679080138"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-type">ConduitWithStream</span></a><span> </span><a href="#local-6989586621679080140"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679080141"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621679080138"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080142"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-64"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-type">ConduitWithStream</span></a><span> </span><a href="#local-6989586621679080139"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679080141"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621679080138"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080142"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-65"></a><a name="fuseStream"><a href="Data.Conduit.Internal.Fusion.html#fuseStream"><span class="hs-identifier">fuseStream</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-var">ConduitWithStream</span></a><span> </span><a name="local-6989586621679080148"><a href="#local-6989586621679080148"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679080149"><a href="#local-6989586621679080149"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-var">ConduitWithStream</span></a><span> </span><a name="local-6989586621679080150"><a href="#local-6989586621679080150"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679080151"><a href="#local-6989586621679080151"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-66"></a><span>  </span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-var">ConduitWithStream</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080148"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Conduit.Internal.Conduit.html#.%7C"><span class="hs-operator hs-var">.|</span></a><span> </span><a href="#local-6989586621679080150"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080151"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679080149"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span class="hs-pragma">{-# INLINE fuseStream #-}</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-pragma">{-# RULES &quot;conduit: fuseStream&quot; forall left right.
        unstream left .| unstream right = unstream (fuseStream left right)
  #-}</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-identifier">runStream</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679080136"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-74"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-type">ConduitWithStream</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">Void</span><span> </span><a href="#local-6989586621679080136"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080137"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-75"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080136"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080137"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-76"></a><a name="runStream"><a href="Data.Conduit.Internal.Fusion.html#runStream"><span class="hs-identifier">runStream</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-var">ConduitWithStream</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679080152"><a href="#local-6989586621679080152"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-77"></a><span>    </span><a href="#local-6989586621679080154"><span class="hs-identifier hs-var">run</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080152"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#Stream"><span class="hs-identifier hs-var">Stream</span></a><span> </span><a href="#local-6989586621679080153"><span class="hs-identifier hs-var">emptyStep</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-79"></a><span>    </span><a name="local-6989586621679080153"><a href="#local-6989586621679080153"><span class="hs-identifier">emptyStep</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#Stop"><span class="hs-identifier hs-var">Stop</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>    </span><a name="local-6989586621679080154"><a href="#local-6989586621679080154"><span class="hs-identifier">run</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Conduit.Internal.Fusion.html#Stream"><span class="hs-identifier hs-var">Stream</span></a><span> </span><a name="local-6989586621679080155"><a href="#local-6989586621679080155"><span class="hs-identifier">step</span></a></a><span> </span><a name="local-6989586621679080156"><a href="#local-6989586621679080156"><span class="hs-identifier">ms0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-81"></a><span>        </span><a href="#local-6989586621679080156"><span class="hs-identifier hs-var">ms0</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679080157"><span class="hs-identifier hs-var">loop</span></a><span>
</span><a name="line-82"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-83"></a><span>        </span><a name="local-6989586621679080157"><a href="#local-6989586621679080157"><span class="hs-identifier">loop</span></a></a><span> </span><a name="local-6989586621679080158"><a href="#local-6989586621679080158"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-84"></a><span>            </span><a name="local-6989586621679080159"><a href="#local-6989586621679080159"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080155"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-6989586621679080158"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-85"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679080159"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-86"></a><span>                </span><a href="Data.Conduit.Internal.Fusion.html#Stop"><span class="hs-identifier hs-var">Stop</span></a><span> </span><a name="local-6989586621679080160"><a href="#local-6989586621679080160"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679080160"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-87"></a><span>                </span><a href="Data.Conduit.Internal.Fusion.html#Skip"><span class="hs-identifier hs-var">Skip</span></a><span> </span><a name="local-6989586621679080161"><a href="#local-6989586621679080161"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080157"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679080161"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-88"></a><span>                </span><a href="Data.Conduit.Internal.Fusion.html#Emit"><span class="hs-identifier hs-var">Emit</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679080162"><a href="#local-6989586621679080162"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">absurd</span><span> </span><a href="#local-6989586621679080162"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-89"></a><span class="hs-pragma">{-# INLINE runStream #-}</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-pragma">{-# RULES &quot;conduit: runStream&quot; forall stream.
        runConduit (unstream stream) = runStream stream
  #-}</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">{-
connectStream :: Monad m
              =&gt; ConduitWithStream () i    m ()
              -&gt; ConduitWithStream i  Void m r
              -&gt; m r
connectStream (ConduitWithStream _ stream) (ConduitWithStream _ f) =
    run $ f $ stream $ Stream emptyStep (return ())
  where
    emptyStep _ = return $ Stop ()
    run (Stream step ms0) =
        ms0 &gt;&gt;= loop
      where
        loop s = do
            res &lt;- step s
            case res of
                Stop r -&gt; return r
                Skip s' -&gt; loop s'
                Emit _ o -&gt; absurd o
{-# INLINE connectStream #-}
-}</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-comment">{- Deprecated
{-# RULES &quot;conduit: connectStream&quot; forall left right.
        unstream left $$ unstream right = connectStream left right
  #-}

connectStream1 :: Monad m
               =&gt; ConduitWithStream () i    m ()
               -&gt; ConduitT          i  Void m r
               -&gt; m r
connectStream1 (ConduitWithStream _ fstream) (ConduitT sink0) =
    case fstream $ Stream (const $ return $ Stop ()) (return ()) of
        Stream step ms0 -&gt;
            let loop _ (Done r) _ = return r
                loop ls (PipeM mp) s = mp &gt;&gt;= flip (loop ls) s
                loop ls (Leftover p l) s = loop (l:ls) p s
                loop _ (HaveOutput _ o) _ = absurd o
                loop (l:ls) (NeedInput p _) s = loop ls (p l) s
                loop [] (NeedInput p c) s = do
                    res &lt;- step s
                    case res of
                        Stop () -&gt; loop [] (c ()) s
                        Skip s' -&gt; loop [] (NeedInput p c) s'
                        Emit s' i -&gt; loop [] (p i) s'
             in ms0 &gt;&gt;= loop [] (sink0 Done)
{-# INLINE connectStream1 #-}
-}</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span class="hs-comment">{- Deprecated
{-# RULES &quot;conduit: connectStream1&quot; forall left right.
        unstream left $$ right = connectStream1 left right
  #-}
-}</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span class="hs-comment">{-

Not only will this rule not fire reliably, but due to finalizers, it can change
behavior unless implemented very carefully. Odds are that the careful
implementation won't be any faster, so leaving this commented out for now.

connectStream2 :: Monad m
               =&gt; ConduitT      () i    m ()
               -&gt; ConduitWithStream i  Void m r
               -&gt; m r
connectStream2 (ConduitT src0) (ConduitWithStream _ fstream) =
    run $ fstream $ Stream step' $ return (return (), src0 Done)
  where
    step' (_, Done ()) = return $ Stop ()
    {-# INLINE step' #-}

    run (Stream step ms0) =
        ms0 &gt;&gt;= loop
      where
        loop s = do
            res &lt;- step s
            case res of
                Stop r -&gt; return r
                Emit _ o -&gt; absurd o
                Skip s' -&gt; loop s'
{-# INLINE connectStream2 #-}

{-# RULES &quot;conduit: connectStream2&quot; forall left right.
        left $$ unstream right = connectStream2 left right
  #-}
-}</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-identifier">streamConduit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Conduit.Internal.Conduit.html#ConduitT"><span class="hs-identifier hs-type">ConduitT</span></a><span> </span><a href="#local-6989586621679080132"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679080133"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080134"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080135"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-182"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Conduit.Internal.Fusion.html#Stream"><span class="hs-identifier hs-type">Stream</span></a><span> </span><a href="#local-6989586621679080134"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080132"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#Stream"><span class="hs-identifier hs-type">Stream</span></a><span> </span><a href="#local-6989586621679080134"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080133"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080135"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-183"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-type">ConduitWithStream</span></a><span> </span><a href="#local-6989586621679080132"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679080133"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080134"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080135"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-184"></a><a name="streamConduit"><a href="Data.Conduit.Internal.Fusion.html#streamConduit"><span class="hs-identifier">streamConduit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-var">ConduitWithStream</span></a><span>
</span><a name="line-185"></a><span class="hs-pragma">{-# INLINE CONLIKE streamConduit #-}</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-identifier">streamSource</span><span>
</span><a name="line-188"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679080129"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-189"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#Stream"><span class="hs-identifier hs-type">Stream</span></a><span> </span><a href="#local-6989586621679080129"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679080130"><span class="hs-identifier hs-type">o</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-type">ConduitWithStream</span></a><span> </span><a href="#local-6989586621679080131"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679080130"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080129"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-191"></a><a name="streamSource"><a href="Data.Conduit.Internal.Fusion.html#streamSource"><span class="hs-identifier">streamSource</span></a></a><span> </span><a name="local-6989586621679080163"><a href="#local-6989586621679080163"><span class="hs-identifier">str</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Conduit.Internal.Fusion.html#Stream"><span class="hs-identifier hs-var">Stream</span></a><span> </span><a name="local-6989586621679080164"><a href="#local-6989586621679080164"><span class="hs-identifier">step</span></a></a><span> </span><a name="local-6989586621679080165"><a href="#local-6989586621679080165"><span class="hs-identifier">ms0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-192"></a><span>    </span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-var">ConduitWithStream</span></a><span> </span><a href="#local-6989586621679080166"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621679080163"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span>
</span><a name="line-193"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-194"></a><span>    </span><a name="local-6989586621679080166"><a href="#local-6989586621679080166"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Conduit.Internal.Conduit.html#ConduitT"><span class="hs-identifier hs-var">ConduitT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679080167"><a href="#local-6989586621679080167"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Conduit.Internal.Pipe.html#PipeM"><span class="hs-identifier hs-var">PipeM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-195"></a><span>        </span><a name="local-6989586621679080168"><a href="#local-6989586621679080168"><span class="hs-identifier">s0</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080165"><span class="hs-identifier hs-var">ms0</span></a><span>
</span><a name="line-196"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080169"><a href="#local-6989586621679080169"><span class="hs-identifier">loop</span></a></a><span> </span><a name="local-6989586621679080170"><a href="#local-6989586621679080170"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-197"></a><span>                </span><a name="local-6989586621679080171"><a href="#local-6989586621679080171"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080164"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-6989586621679080170"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-198"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679080171"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-199"></a><span>                    </span><a href="Data.Conduit.Internal.Fusion.html#Stop"><span class="hs-identifier hs-var">Stop</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080167"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>                    </span><a href="Data.Conduit.Internal.Fusion.html#Emit"><span class="hs-identifier hs-var">Emit</span></a><span> </span><a name="local-6989586621679080172"><a href="#local-6989586621679080172"><span class="hs-identifier">s'</span></a></a><span> </span><a name="local-6989586621679080173"><a href="#local-6989586621679080173"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Conduit.Internal.Pipe.html#HaveOutput"><span class="hs-identifier hs-var">HaveOutput</span></a><span> </span><span class="hs-special">(</span><a href="Data.Conduit.Internal.Pipe.html#PipeM"><span class="hs-identifier hs-var">PipeM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080169"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679080172"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080173"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-201"></a><span>                    </span><a href="Data.Conduit.Internal.Fusion.html#Skip"><span class="hs-identifier hs-var">Skip</span></a><span> </span><a name="local-6989586621679080174"><a href="#local-6989586621679080174"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080169"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679080174"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-202"></a><span>        </span><a href="#local-6989586621679080169"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679080168"><span class="hs-identifier hs-var">s0</span></a><span>
</span><a name="line-203"></a><span class="hs-pragma">{-# INLINE streamSource #-}</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span class="hs-identifier">streamSourcePure</span><span>
</span><a name="line-206"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679080126"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-207"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#Stream"><span class="hs-identifier hs-type">Stream</span></a><span> </span><span class="hs-identifier hs-type">Identity</span><span> </span><a href="#local-6989586621679080127"><span class="hs-identifier hs-type">o</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-type">ConduitWithStream</span></a><span> </span><a href="#local-6989586621679080128"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679080127"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679080126"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-209"></a><a name="streamSourcePure"><a href="Data.Conduit.Internal.Fusion.html#streamSourcePure"><span class="hs-identifier">streamSourcePure</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Conduit.Internal.Fusion.html#Stream"><span class="hs-identifier hs-var">Stream</span></a><span> </span><a name="local-6989586621679080175"><a href="#local-6989586621679080175"><span class="hs-identifier">step</span></a></a><span> </span><a name="local-6989586621679080176"><a href="#local-6989586621679080176"><span class="hs-identifier">ms0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-210"></a><span>    </span><a href="Data.Conduit.Internal.Fusion.html#ConduitWithStream"><span class="hs-identifier hs-var">ConduitWithStream</span></a><span> </span><a href="#local-6989586621679080178"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Conduit.Internal.Fusion.html#Stream"><span class="hs-identifier hs-var">Stream</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">runIdentity</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679080175"><span class="hs-identifier hs-var">step</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679080177"><span class="hs-identifier hs-var">s0</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-211"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-212"></a><span>    </span><a name="local-6989586621679080177"><a href="#local-6989586621679080177"><span class="hs-identifier">s0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runIdentity</span><span> </span><a href="#local-6989586621679080176"><span class="hs-identifier hs-var">ms0</span></a><span>
</span><a name="line-213"></a><span>    </span><a name="local-6989586621679080178"><a href="#local-6989586621679080178"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Conduit.Internal.Conduit.html#ConduitT"><span class="hs-identifier hs-var">ConduitT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679080179"><a href="#local-6989586621679080179"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-214"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080180"><a href="#local-6989586621679080180"><span class="hs-identifier">loop</span></a></a><span> </span><a name="local-6989586621679080181"><a href="#local-6989586621679080181"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-215"></a><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">runIdentity</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080175"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-6989586621679080181"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-216"></a><span>                    </span><a href="Data.Conduit.Internal.Fusion.html#Stop"><span class="hs-identifier hs-var">Stop</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080179"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>                    </span><a href="Data.Conduit.Internal.Fusion.html#Emit"><span class="hs-identifier hs-var">Emit</span></a><span> </span><a name="local-6989586621679080182"><a href="#local-6989586621679080182"><span class="hs-identifier">s'</span></a></a><span> </span><a name="local-6989586621679080183"><a href="#local-6989586621679080183"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Conduit.Internal.Pipe.html#HaveOutput"><span class="hs-identifier hs-var">HaveOutput</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080180"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679080182"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080183"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-218"></a><span>                    </span><a href="Data.Conduit.Internal.Fusion.html#Skip"><span class="hs-identifier hs-var">Skip</span></a><span> </span><a name="local-6989586621679080184"><a href="#local-6989586621679080184"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080180"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679080184"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-219"></a><span>         </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679080180"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679080177"><span class="hs-identifier hs-var">s0</span></a><span>
</span><a name="line-220"></a><span class="hs-pragma">{-# INLINE streamSourcePure #-}</span><span>
</span><a name="line-221"></a></pre></body></html>